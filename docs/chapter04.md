# 4. メモリ管理

## 原則1: ディスクアクセスを最小にする

||RAM|フラッシュメモリ|ディスク|
|:--|--:|--:|--:|
|速度比|1|1000|100000|

- データベースエンジンは、メモリページを使ってディスクブロックをキャッシュ
- 同一ページへの複数書き込みは単一ディスク書き込みにしたい
- SQLクエリに複数の検索アルゴリズム候補がある場合、ディスクアクセスが最小になりそうなものを選ぶ

## 原則2: 仮想メモリに頼らない

- OSのページスワップにより、システムクラッシュ後のデータベースエンジンの復旧能力が低下
  - データレコードの変更がディスクに保存される前に、関連するログレコードのページを保存する必要があり
- OSは、どのページが使用されていてどのページが使用されていないかを知らずにスワップアウトを行う
- データベースエンジンは自身のページを管理する必要がある
  - 物理メモリになるべく小さいページ数を確保
  - データベースのバッファプールとして知られる

## ログ管理

- データベースエンジンは変更を巻き戻すために変更を記録し続けるのが必要
- ログマネージャ = 増え続けるログレコードの書き込みを担うコンポーネント
  - ログの中身はリカバリーマネージャが行うので把握しない
